<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B√ìR·∫û√ï√ë Private Chat</title>

  <style>
    /* ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü */
    body{ margin:0; font-family:sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; height:100vh; }

    /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú */
    #loginBox{ margin:auto; text-align:center; padding: 20px; }
    input{ padding:12px; margin:8px; font-size:16px; width:220px; border:none; border-radius:8px; outline:none; }
    button{ padding:12px 20px; font-size:16px; background:#00ff88; color: #000; font-weight: bold; border:none; border-radius:8px; cursor:pointer; }

    /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏ (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) */
    #chatBox{ display:none; flex:1; flex-direction:column; width: 100%; max-width: 600px; margin: 0 auto; background: #000; }

    /* ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
    #messages{ flex:1; overflow-y:auto; padding:15px; display: flex; flex-direction: column; gap: 8px; }

    /* ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® (Fixed) */
    .msg{ padding:10px 14px; border-radius:12px; font-size:15px; max-width: 75%; word-wrap: break-word; }
    
    /* ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú (‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï‡ßá) */
    .msg.right { background: #00ff88; color: #000; align-self: flex-end; border-top-right-radius: 2px; }
    
    /* ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú (‡¶¨‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶ï‡ßá) */
    .msg.left { background: #333; color: #fff; align-self: flex-start; border-top-left-radius: 2px; }
    .sender-name { font-size: 10px; opacity: 0.7; display: block; margin-bottom: 2px;}

    /* ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
    #inputArea{ display:flex; padding:10px; background:#222; border-top: 1px solid #333; }
    #msgInput{ flex:1; font-size:16px; padding:12px; border-radius:20px; border: none; outline: none; }
    #sendBtn{ margin-left:8px; background: #00ff88; color: #000; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; padding: 0;}

    /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü */
    #userList{ background:#1a1a1a; padding:10px; display:none; overflow-x:auto; white-space:nowrap; border-bottom: 1px solid #333; }
    .userBtn{ background:#444; padding:8px 15px; margin-right:8px; border-radius:20px; cursor:pointer; display:inline-block; font-size: 14px; }
    .userBtn.active { background: #00ff88; color: #000; font-weight: bold; }
  </style>
</head>
<body>

<div id="loginBox">
  <h2 style="color: #00ff88;">Secure Chat</h2>
  <input id="name" placeholder="Enter Name..."><br>
  <button onclick="login()">Start Chat</button>
  <p style="font-size: 12px; color: #666; margin-top: 10px;">Admin Login: Type 'admin' as name</p>
</div>

<div id="userList"></div>

<div id="chatBox">
  <div id="chatHeader" style="padding: 10px; background: #111; text-align: center; font-size: 14px; color: #00ff88; border-bottom: 1px solid #222; display: none;">
    Chatting with: <span id="currentChatUser">...</span>
  </div>

  <div id="messages"></div>

  <div id="inputArea">
    <input id="msgInput" placeholder="Type a message...">
    <button id="sendBtn" onclick="sendMsg()">‚û§</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* üî• ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá */
const firebaseConfig = {
  apiKey: "AIzaSyBEiUjtqLlT_cMCE0ba9mweak5QQp915vQ",
  authDomain: "borson-chat-web.firebaseapp.com",
  databaseURL: "https://borson-chat-web-default-rtdb.firebaseio.com",
  projectId: "borson-chat-web",
  storageBucket: "borson-chat-web.firebasestorage.app",
  messagingSenderId: "694928126106",
  appId: "1:694928126106:web:d02ab12ed214accd335528"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ */
const ADMIN_NAME = "borson_admin"; // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶®‡¶æ‡¶Æ
let myName = "";
let isAdmin = false;
let chatID = ""; // ‡¶´‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ID ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ID

/* üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® */
function login(){
  const nameInput = document.getElementById("name").value.trim();

  if(!nameInput){ alert("Please enter a name"); return; }

  myName = nameInput;

  // üëë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ö‡ßá‡¶ï
  if(myName === ADMIN_NAME){
    isAdmin = true;
    document.getElementById("userList").style.display="block";
    document.getElementById("chatHeader").style.display="block";
    loadUserList(); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶°
  } else {
    // üë§ ‡¶´‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡¶ó‡¶á‡¶® (‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶ü‡¶æ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶â‡¶®‡¶ø‡¶ï ID ‡¶¨‡¶æ‡¶®‡¶æ‡¶á)
    // ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶á ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶¶‡ßÅ‡¶á‡¶ú‡¶® ‡¶Æ‡¶ø‡¶ï‡ßç‡¶∏ ‡¶®‡¶æ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡ßü
    if(!localStorage.getItem("myChatID")) {
        localStorage.setItem("myChatID", nameInput + "_" + Math.floor(Math.random() * 1000));
    }
    chatID = localStorage.getItem("myChatID");
    
    // ‡¶´‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
    db.ref("chats/" + chatID + "/info").set({ name: myName, lastActive: Date.now() });
    
    loadMessages(chatID); // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ
  }

  document.getElementById("loginBox").style.display="none";
  document.getElementById("chatBox").style.display="flex";
}

/* üëë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ */
function loadUserList(){
  db.ref("chats").on("child_added", snap => {
    const uid = snap.key;
    const userData = snap.val().info; // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
    const displayUser = userData ? userData.name : uid;

    const btn = document.createElement("span");
    btn.className="userBtn";
    btn.textContent = displayUser;

    btn.onclick = function(){
      // ‡¶∏‡¶¨ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶æ‡¶®‡ßã
      document.querySelectorAll('.userBtn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
      chatID = uid;
      document.getElementById("currentChatUser").innerText = displayUser;
      document.getElementById("messages").innerHTML = ""; // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
      loadMessages(uid);
    };

    document.getElementById("userList").appendChild(btn);
  });
}

/* üì© ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã */
function sendMsg(){
  const input = document.getElementById("msgInput");
  const text = input.value.trim();

  // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ø‡¶¶‡¶ø ‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá
  if(isAdmin && !chatID) { alert("Please select a user first!"); return; }
  if(text===""){ return; }

  // sender ‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (Admin ‡¶®‡¶æ‡¶ï‡¶ø ‡¶´‡ßç‡¶Ø‡¶æ‡¶®)
  const senderName = isAdmin ? "Admin" : "User";

  db.ref("chats/" + chatID + "/messages").push({
    msg: text,
    sender: senderName, // ‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶≤‡ßã
    timestamp: Date.now()
  });

  input.value="";
}

/* üì• ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ */
let currentListener = null;

function loadMessages(path){
  const box = document.getElementById("messages");
  
  // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ (‡¶Ø‡¶æ‡¶§‡ßá ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶®‡¶æ ‡¶Ü‡¶∏‡ßá)
  if(currentListener) db.ref("chats/" + path + "/messages").off();

  currentListener = db.ref("chats/" + path + "/messages");
  
  currentListener.on("child_added", snap => {
    const data = snap.val();
    
    // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡¶ï‡¶ø ‡¶¨‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶ï‡ßá?
    // ‡¶Ü‡¶Æ‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® + ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá‡¶õ‡ßá Admin = ‡¶°‡¶æ‡¶®‡ßá (Right)
    // ‡¶Ü‡¶Æ‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ + ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá‡¶õ‡ßá User = ‡¶°‡¶æ‡¶®‡ßá (Right)
    let isMe = false;
    if(isAdmin && data.sender === "Admin") isMe = true;
    if(!isAdmin && data.sender === "User") isMe = true;

    const div = document.createElement("div");
    div.className = isMe ? "msg right" : "msg left";
    
    // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡ßá ‡¶®‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
    div.innerHTML = `
      ${!isMe ? `<span class="sender-name">${isAdmin ? 'Fan' : 'Admin'}</span>` : ''}
      ${data.msg}
    `;

    box.appendChild(div);
    box.scrollTop = box.scrollHeight; // ‡¶Ö‡¶ü‡ßã ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤
  });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>BÃ“RáºžÃ•Ã‘ VIP Estate</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #00ff88;
      --primary-dark: #00cc6a;
      --dark-bg: #0a0a0a;
      --glass-bg: rgba(20, 20, 20, 0.7);
      --glass-border: 1px solid rgba(0, 255, 136, 0.2);
      --neon-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
    body { 
      font-family: 'Poppins', sans-serif; 
      background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%); 
      color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative; 
    }

    #bg-animation {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .falling-icon {
      position: absolute; top: -10%; color: var(--primary); opacity: 0;
      animation: fall linear infinite;
      text-shadow: 0 0 5px var(--primary);
    }
    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 0; }
      15% { opacity: 0.5; }
      85% { opacity: 0.5; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    #loginBox { 
      margin: auto; text-align: center; background: var(--glass-bg); 
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      padding: 35px 30px; border-radius: 25px; width: 85%; max-width: 380px; 
      border: var(--glass-border); box-shadow: var(--neon-shadow);
      z-index: 10; position: relative; animation: popup 0.5s ease-out;
    }
    @keyframes popup { from{transform: scale(0.9); opacity: 0;} to{transform: scale(1); opacity: 1;} }

    h2.title { color: var(--primary); font-weight: 600; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0,255,136,0.4); margin-bottom: 5px; }
    p.subtitle { font-size: 13px; color: #aaa; margin-bottom: 25px; }

    input { 
      width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; 
      border: 1px solid #333; background: rgba(40,40,40,0.8); color: #fff; 
      outline: none; font-size: 16px;
    }
    input:focus { border-color: var(--primary); }

    .btn-main { 
      width: 100%; padding: 15px; background: linear-gradient(45deg, var(--primary-dark), var(--primary)); 
      color: #000; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; margin-top: 15px;
    }

    #chatBox { display: none; flex: 1; flex-direction: column; z-index: 5; height: 100%; }
    
    #chatHeader { 
      padding: 15px 20px; background: rgba(20, 20, 20, 0.9); 
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 136, 0.1);
      display: flex; justify-content: space-between; align-items: center;
    }
    .header-title { font-weight: 600; color: var(--primary); font-size: 18px; display: flex; align-items: center; gap: 10px; }
    
    #deleteAllBtn { color: #ff4444; font-size: 20px; cursor: pointer; display: none; margin-left: 15px; }

    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    
    .msg { 
      padding: 12px 16px; border-radius: 18px; font-size: 15px; max-width: 78%; 
      position: relative; word-wrap: break-word; box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    .msg img { max-width: 100%; border-radius: 12px; margin-top: 8px; }
    .msg.right { background: linear-gradient(135deg, #00b862, #008f4c); align-self: flex-end; border-bottom-right-radius: 4px; color: white; }
    .msg.left { background: rgba(40, 40, 40, 0.9); align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #333; }
    
    .delete-btn {
      position: absolute; top: -10px; right: -10px; background: #ff4444; color: white;
      width: 24px; height: 24px; border-radius: 50%; font-size: 10px;
      display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: 0.2s;
    }
    .msg:hover .delete-btn { opacity: 1; }

    #inputArea { 
      padding: 15px; background: rgba(20,20,20,0.95); display: flex; align-items: center; gap: 12px; 
      border-top: 1px solid #333; padding-bottom: calc(15px + env(safe-area-inset-bottom));
    }
    #msgInput { flex: 1; padding: 14px 20px; border-radius: 30px; border: none; background: #2a2a2a; color: white; }
    .send-btn { background: var(--primary); width: 50px; height: 50px; border-radius: 50%; border: none; font-size: 20px; }

    #adminPanel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 20; display: none; flex-direction: column; }
    .user-item { padding: 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
  </style>
</head>
<body>

  <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3" preload="auto"></audio>
  <div id="bg-animation"></div>

  <div id="loginBox">
    <h2 class="title">BÃ“RáºžÃ•Ã‘ ESTATE</h2>
    <p class="subtitle">Premium Encrypted Workspace</p>
    <input id="name" placeholder="Codename">
    <input id="pass" type="password" placeholder="Access Key">
    <button class="btn-main" onclick="requestPermissionAndLogin()">ACCESS SYSTEM</button>
  </div>

  <div id="adminPanel">
    <div style="padding: 20px; color: var(--primary); font-weight: 600;">ACTIVE CLIENTS</div>
    <div id="userListContainer"></div>
  </div>

  <div id="chatBox">
    <div id="chatHeader">
      <div style="display: flex; align-items: center;">
        <i id="backBtn" class="fa-solid fa-chevron-left" onclick="closeChat()" style="display:none; color: var(--primary); margin-right: 15px;"></i>
        <div class="header-title"><span id="chatTitle">VIP Support</span></div>
      </div>
      <i id="deleteAllBtn" class="fa-solid fa-trash-can" onclick="deleteAllMessages()"></i>
    </div>
    <div id="messages"></div>
    <div id="inputArea">
      <label for="imgInput"><i class="fa-solid fa-camera" style="color:var(--primary); font-size:24px;"></i></label>
      <input type="file" id="imgInput" hidden accept="image/*" onchange="sendImage(this)">
      <input id="msgInput" placeholder="Message...">
      <button class="send-btn" onclick="sendMsg()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBEiUjtqLlT_cMCE0ba9mweak5QQp915vQ",
      authDomain: "borson-chat-web.firebaseapp.com",
      databaseURL: "https://borson-chat-web-default-rtdb.firebaseio.com",
      projectId: "borson-chat-web",
      storageBucket: "borson-chat-web.firebasestorage.app",
      messagingSenderId: "694928126305",
      appId: "1:694928126305:web:d02ab12ed214accd335528"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messaging = firebase.messaging();

    function createMoneyRain() {
      const container = document.getElementById('bg-animation');
      const icons = ['fa-sack-dollar', 'fa-bitcoin', 'fa-credit-card', 'fa-money-bill-wave', 'fa-gem'];
      setInterval(() => {
        const icon = document.createElement('i');
        icon.classList.add('fa-solid', icons[Math.floor(Math.random() * icons.length)], 'falling-icon');
        icon.style.left = Math.random() * 100 + 'vw';
        icon.style.fontSize = (Math.random() * 20 + 15) + 'px';
        icon.style.animationDuration = (Math.random() * 4 + 3) + 's'; 
        container.appendChild(icon);
        setTimeout(() => icon.remove(), 7000);
      }, 400);
    }
    createMoneyRain();

    let myName = "", myID = "", isAdmin = false, activeChatID = "";
    let notificationEnabled = false;

    function requestPermissionAndLogin() {
      Notification.requestPermission().then((permission) => {
        if (permission === 'granted') {
          notificationEnabled = true;
          // Register VAPID Key for background notifications
          messaging.getToken({ vapidKey: 'BMmuOngbWH5JfBpQCWDQULyoXHapgxJO2JHWZkiiHvFT-V5no5HXefOPoLmxeoEwrPTK-LYsiJnSqupgLNBTBc' })
          .then((token) => { console.log("Notify Token Active"); })
          .catch((err) => { console.log('Token error', err); });
        }
        login();
      });
    }

    function login() {
      const name = document.getElementById("name").value.trim();
      const pass = document.getElementById("pass").value.trim();
      if (name === "borson_admin" && pass === "1234") {
        isAdmin = true; myName = "Admin";
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminPanel").style.display = "flex";
        loadUserList();
      } else {
        isAdmin = false; myName = name;
        myID = btoa(name + "_" + pass).replace(/=/g, ""); 
        activeChatID = myID;
        db.ref("users/" + myID).update({ name: myName, lastActive: Date.now() });
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("chatBox").style.display = "flex";
        loadMessages(myID);
      }
    }

    function loadUserList() {
      db.ref("users").on("value", snap => {
        const list = document.getElementById("userListContainer");
        list.innerHTML = "";
        snap.forEach(child => {
          const div = document.createElement("div");
          div.className = "user-item";
          div.innerHTML = `<div>${child.val().name}</div><div style="color:var(--primary)">OPEN</div>`;
          div.onclick = () => {
            activeChatID = child.key;
            document.getElementById("adminPanel").style.display = "none";
            document.getElementById("chatBox").style.display = "flex";
            document.getElementById("chatTitle").innerText = child.val().name;
            document.getElementById("backBtn").style.display = "block";
            document.getElementById("deleteAllBtn").style.display = "block";
            loadMessages(child.key);
          };
          list.appendChild(div);
        });
      });
    }

    function closeChat() {
      document.getElementById("chatBox").style.display = "none";
      document.getElementById("adminPanel").style.display = "flex";
      activeChatID = "";
    }

    function sendMsg() {
      const input = document.getElementById("msgInput");
      if (!input.value.trim()) return;
      pushToDB(input.value.trim(), 'text');
      if (!isAdmin) checkAndSendAutoReply(activeChatID);
      input.value = "";
    }

    function checkAndSendAutoReply(uid) {
      const last = localStorage.getItem("lastAutoReplyTime");
      if (!last || (Date.now() - last > 1800000)) {
        setTimeout(() => {
          db.ref("chats/" + uid).push({ msg: "WAIT ðŸ«¸.........", type: "text", sender: "Admin", time: Date.now() });
          localStorage.setItem("lastAutoReplyTime", Date.now());
        }, 1500);
      }
    }

    function sendImage(input) {
      const reader = new FileReader();
      reader.onload = e => {
        pushToDB(e.target.result, 'img');
        if (!isAdmin) checkAndSendAutoReply(activeChatID);
      };
      reader.readAsDataURL(input.files[0]);
    }

    function pushToDB(content, type) {
      db.ref("chats/" + activeChatID).push({ msg: content, type: type, sender: isAdmin ? "Admin" : myName, time: Date.now() });
    }

    let msgRef;
    function loadMessages(uid) {
      const box = document.getElementById("messages");
      box.innerHTML = "";
      if (msgRef) msgRef.off();
      msgRef = db.ref("chats/" + uid);
      msgRef.on("child_added", snap => {
        const data = snap.val();
        if (!isAdmin && data.hiddenForUser) return;
        
        const isMe = data.sender === (isAdmin ? "Admin" : myName);

        if (!isMe) {
          document.getElementById("notifSound").play().catch(()=>{});
          if("vibrate" in navigator) navigator.vibrate([200, 100, 200]);
          if (document.hidden && notificationEnabled) {
            new Notification("BÃ“RáºžÃ•Ã‘ ESTATE", { body: data.type === 'img' ? 'ðŸ“· Photo' : data.msg });
          }
        }

        const div = document.createElement("div");
        div.className = isMe ? "msg right" : "msg left";
        let content = data.type === 'img' ? `<img src="${data.msg}">` : data.msg;
        let delBtn = (isAdmin || isMe) ? `<div class="delete-btn" onclick="deleteMessage('${uid}', '${snap.key}')"><i class="fa-solid fa-trash"></i></div>` : "";
        div.innerHTML = `${content}<span class="time">${new Date(data.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>${delBtn}`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
      });
      msgRef.on("child_removed", () => loadMessages(uid));
      msgRef.on("child_changed", () => loadMessages(uid));
    }

    window.deleteMessage = function(chatPath, msgKey) {
      if (isAdmin) {
        if (confirm("Delete for everyone?")) db.ref("chats/" + chatPath + "/" + msgKey).remove();
      } else {
        if (confirm("Hide for you?")) db.ref("chats/" + chatPath + "/" + msgKey).update({ hiddenForUser: true });
      }
    };

    window.deleteAllMessages = function() {
      if (confirm("Wipe entire chat?")) db.ref("chats/" + activeChatID).remove();
    };
  </script>
</body>
</html>

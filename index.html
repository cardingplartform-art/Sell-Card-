<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>B√ìR·∫û√ï√ë Secure Chat</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #111; color: #fff; height: 100vh; display: flex; flex-direction: column; }

    /* Login Screen */
    #loginBox { margin: auto; text-align: center; background: #1a1a1a; padding: 30px; border-radius: 15px; width: 90%; max-width: 350px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
    input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #222; color: #fff; outline: none; font-size: 16px; }
    button { width: 100%; padding: 12px; background: #00ff88; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
    button:active { transform: scale(0.98); }

    /* Admin User List */
    #userList { background: #000; padding: 10px; display: none; overflow-x: auto; white-space: nowrap; border-bottom: 2px solid #00ff88; }
    .userBtn { background: #333; padding: 8px 15px; margin-right: 8px; border-radius: 20px; cursor: pointer; display: inline-block; font-size: 14px; }
    .userBtn.active { background: #00ff88; color: #000; }

    /* Chat Area */
    #chatBox { display: none; flex: 1; flex-direction: column; background: #000; position: relative; }
    #chatHeader { padding: 12px; background: #1a1a1a; text-align: center; border-bottom: 1px solid #333; font-size: 14px; color: #00ff88; }
    
    #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
    .msg { padding: 10px 14px; border-radius: 15px; font-size: 15px; max-width: 80%; word-wrap: break-word; position: relative; line-height: 1.4; }
    .msg.right { background: #005c4b; color: #e9edef; align-self: flex-end; border-bottom-right-radius: 2px; }
    .msg.left { background: #202c33; color: #e9edef; align-self: flex-start; border-bottom-left-radius: 2px; }
    .time { font-size: 10px; opacity: 0.5; margin-top: 5px; display: block; text-align: right; }

    /* Input Area */
    #inputArea { display: flex; padding: 10px; background: #1a1a1a; align-items: center; gap: 8px; }
    #msgInput { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #2a3942; color: #fff; outline: none; }
    #sendBtn { background: #00ff88; border: none; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; }
  </style>
</head>
<body>

<div id="loginBox">
  <h2 style="color: #00ff88; margin-bottom: 15px;">B√ìR·∫û√ï√ë Chat</h2>
  <input id="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (Name)">
  <input id="pass" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (Password)">
  <button onclick="login()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® (Login)</button>
  <p style="font-size: 11px; color: #666; margin-top: 15px;">‡¶è‡¶ï‡¶á ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶´‡¶ø‡¶∞‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
</div>

<div id="userList"></div>

<div id="chatBox">
  <div id="chatHeader">Chat: <span id="currentTitle">Waiting...</span></div>
  <div id="messages"></div>
  <div id="inputArea">
    <input id="msgInput" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
    <button id="sendBtn" onclick="sendMsg()">‚û§</button>
  </div>
</div>

<audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* üî• ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó */
const firebaseConfig = {
  apiKey: "AIzaSyBEiUjtqLlT_cMCE0ba9mweak5QQp915vQ",
  authDomain: "borson-chat-web.firebaseapp.com",
  databaseURL: "https://borson-chat-web-default-rtdb.firebaseio.com",
  projectId: "borson-chat-web",
  storageBucket: "borson-chat-web.firebasestorage.app",
  messagingSenderId: "694928126106",
  appId: "1:694928126106:web:d02ab12ed214accd335528"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myName = "";
let myID = "";
let isAdmin = false;
let activeChatID = "";

/* üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ */
function login() {
  const name = document.getElementById("name").value.trim().toLowerCase();
  const pass = document.getElementById("pass").value.trim();

  if (!name || !pass) return alert("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®!");

  // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ö‡ßá‡¶ï (‡¶®‡¶æ‡¶Æ: borson_admin, ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°: 1234)
  if (name === "borson_admin" && pass === "1234") {
    isAdmin = true;
    myName = "Admin";
    document.getElementById("userList").style.display = "block";
    loadUserList();
  } else {
    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶§‡ßà‡¶∞‡¶ø (‡¶®‡¶æ‡¶Æ + ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶â‡¶®‡¶ø‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø)
    myID = btoa(name + pass).replace(/=/g, ""); // Base64 encoding
    myName = name;
    activeChatID = myID;
    
    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡ßü)
    db.ref("users/" + myID).update({ name: name, lastSeen: Date.now() });
    
    document.getElementById("currentTitle").innerText = "Admin";
    loadMessages(myID);
  }

  document.getElementById("loginBox").style.display = "none";
  document.getElementById("chatBox").style.display = "flex";
}

/* üëë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° */
function loadUserList() {
  db.ref("users").on("value", snap => {
    const list = document.getElementById("userList");
    list.innerHTML = "";
    snap.forEach(child => {
      const user = child.val();
      const uid = child.key;
      const btn = document.createElement("span");
      btn.className = "userBtn";
      btn.textContent = user.name.toUpperCase();
      btn.onclick = () => {
        document.querySelectorAll('.userBtn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeChatID = uid;
        document.getElementById("currentTitle").innerText = user.name.toUpperCase();
        loadMessages(uid);
      };
      list.appendChild(btn);
    });
  });
}

/* üì© ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã */
function sendMsg() {
  const input = document.getElementById("msgInput");
  const text = input.value.trim();
  if (!text || !activeChatID) return;

  const msgData = {
    text: text,
    sender: isAdmin ? "Admin" : myName,
    time: Date.now()
  };

  db.ref("chats/" + activeChatID).push(msgData);
  input.value = "";
}

/* üì• ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ì ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® */
let firstLoad = true;
function loadMessages(chatID) {
  const box = document.getElementById("messages");
  box.innerHTML = "";
  db.ref("chats/" + chatID).off();
  
  db.ref("chats/" + chatID).on("child_added", snap => {
    const data = snap.val();
    const isMe = data.sender === (isAdmin ? "Admin" : myName);
    
    const div = document.createElement("div");
    div.className = isMe ? "msg right" : "msg left";
    div.innerHTML = `${data.text} <span class="time">${new Date(data.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>`;
    
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;

    // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° (‡¶Ø‡¶¶‡¶ø ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßá‡¶â ‡¶™‡¶æ‡¶†‡¶æ‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶π‡ßü)
    if (!isMe && !firstLoad) {
      document.getElementById("notifSound").play();
    }
  });
  
  // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶π‡¶¨‡ßá
  setTimeout(() => { firstLoad = false; }, 2000);
}
</script>

</body>
</html>

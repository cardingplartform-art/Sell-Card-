<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>B√ìR·∫û√ï√ë VIP Estate</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #00ff88;
      --primary-dark: #00cc6a;
      --dark-bg: #0a0a0a;
      --glass-bg: rgba(20, 20, 20, 0.7);
      --glass-border: 1px solid rgba(0, 255, 136, 0.2);
      --neon-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
    body { 
      font-family: 'Poppins', sans-serif; 
      background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%); 
      color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative; 
    }

    /* üí∏ Money Rain Animation */
    #bg-animation {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .falling-icon {
      position: absolute; top: -10%; color: var(--primary); opacity: 0;
      animation: fall linear infinite;
      text-shadow: 0 0 5px var(--primary);
    }
    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 0; }
      10% { opacity: 0.5; }
      90% { opacity: 0.5; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    /* üîê Login Box */
    #loginBox { 
      margin: auto; text-align: center; 
      background: var(--glass-bg); 
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      padding: 35px 30px; border-radius: 25px; width: 85%; max-width: 380px; 
      border: var(--glass-border); 
      box-shadow: var(--neon-shadow), inset 0 0 20px rgba(0, 255, 136, 0.05);
      z-index: 10; position: relative; animation: popup 0.5s ease-out;
    }
    @keyframes popup { from{transform: scale(0.9); opacity: 0;} to{transform: scale(1); opacity: 1;} }

    h2.title { color: var(--primary); font-weight: 600; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0,255,136,0.4); margin-bottom: 5px; }
    p.subtitle { font-size: 13px; color: #aaa; margin-bottom: 25px; }

    input { 
      width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; 
      border: 1px solid #333; background: rgba(40,40,40,0.8); color: #fff; 
      outline: none; font-size: 16px; transition: 0.3s;
    }
    input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 255, 136, 0.2); }

    .btn-main { 
      width: 100%; padding: 15px; 
      background: linear-gradient(45deg, var(--primary-dark), var(--primary)); 
      color: #000; border: none; border-radius: 12px; font-weight: 600; 
      cursor: pointer; font-size: 16px; transition: 0.3s; margin-top: 15px;
      box-shadow: var(--neon-shadow);
    }
    .btn-main:active { transform: scale(0.97); }

    /* üëë Chat Area */
    #chatBox { display: none; flex: 1; flex-direction: column; z-index: 5; height: 100%; backdrop-filter: blur(5px); }
    
    #chatHeader { 
      padding: 15px 20px; 
      background: rgba(20, 20, 20, 0.8); 
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 255, 136, 0.1);
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .header-title { font-weight: 600; color: var(--primary); font-size: 18px; display: flex; align-items: center; gap: 10px; }
    
    #deleteAllBtn { color: #ff4444; font-size: 20px; cursor: pointer; display: none; margin-left: 15px; transition: 0.3s; }
    #deleteAllBtn:hover { text-shadow: 0 0 10px #ff4444; }

    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
    
    .msg { 
      padding: 12px 16px; border-radius: 18px; font-size: 15px; 
      max-width: 78%; position: relative; word-wrap: break-word; 
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      animation: fadeIn 0.3s ease-out;
    }
    @keyframes fadeIn { from{opacity:0; transform: translateY(10px);} to{opacity:1; transform: translateY(0);} }
    .msg img { max-width: 100%; border-radius: 12px; margin-top: 8px; border: 1px solid #444; }
    
    .msg.right { background: linear-gradient(135deg, #00b862, #008f4c); align-self: flex-end; border-bottom-right-radius: 4px; color: white; }
    .msg.left { background: rgba(40, 40, 40, 0.9); backdrop-filter: blur(5px); align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #333; }
    
    .time { font-size: 10px; opacity: 0.7; text-align: right; margin-top: 5px; display: block; font-weight: 300; }

    .delete-btn {
      position: absolute; top: -10px; right: -10px; 
      background: linear-gradient(45deg, #ff4444, #cc0000); color: white;
      width: 24px; height: 24px; border-radius: 50%; font-size: 12px;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      border: 2px solid #000; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      opacity: 0; transition: 0.2s;
    }
    .msg:hover .delete-btn { opacity: 1; }

    #inputArea { 
      padding: 15px; background: rgba(20,20,20,0.95); backdrop-filter: blur(10px);
      display: flex; align-items: center; gap: 12px; 
      border-top: 1px solid #333;
      padding-bottom: calc(15px + env(safe-area-inset-bottom));
    }
    #msgInput { flex: 1; padding: 14px 20px; border-radius: 30px; border: none; background: #2a2a2a; color: white; font-size: 16px; }
    .icon-btn { font-size: 24px; color: var(--primary); cursor: pointer; padding: 5px; transition: 0.2s; }
    .send-btn { 
      background: linear-gradient(45deg, var(--primary-dark), var(--primary)); 
      width: 50px; height: 50px; border-radius: 50%; border: none; 
      display: flex; align-items: center; justify-content: center; font-size: 20px; color: #000;
      box-shadow: var(--neon-shadow); transition: 0.2s;
    }
    .send-btn:active { transform: scale(0.9); }

    #adminPanel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); z-index: 20; display: none; flex-direction: column; }
    .user-item { padding: 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.02); }
    .user-item:hover { background: rgba(0, 255, 136, 0.05); }
    .unread-badge { background: var(--primary); color: #000; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; box-shadow: 0 0 5px var(--primary); }
  </style>
</head>
<body>

  <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

  <div id="bg-animation"></div>

  <div id="loginBox">
    <h2 class="title">B√ìR·∫û√ï√ë ESTATE</h2>
    <p class="subtitle">Premium Encrypted Workspace</p>
    <input id="name" placeholder="Codename" autocomplete="off">
    <input id="pass" type="password" placeholder="Access Key">
    <button class="btn-main" onclick="requestPermissionAndLogin()">
      <i class="fa-solid fa-fingerprint"></i> ACCESS SYSTEM
    </button>
  </div>

  <div id="adminPanel">
    <div style="padding: 20px; background: rgba(20,20,20,0.9); border-bottom: 1px solid var(--primary); color: var(--primary); font-weight: 600; letter-spacing: 1px;">
      <i class="fa-solid fa-list-ul"></i> ACTIVE CLIENTS
    </div>
    <div id="userListContainer" style="overflow-y: auto;"></div>
  </div>

  <div id="chatBox">
    <div id="chatHeader">
      <div style="display: flex; align-items: center;">
        <div id="backBtn" onclick="closeChat()" style="display:none; cursor:pointer; color: var(--primary); font-size: 22px; margin-right: 15px;">
          <i class="fa-solid fa-chevron-left"></i>
        </div>
        <div class="header-title">
          <i class="fa-solid fa-shield-cat"></i> 
          <span id="chatTitle" style="margin-left: 8px;">VIP Support</span>
        </div>
      </div>
      
      <div>
        <i id="deleteAllBtn" class="fa-solid fa-trash-can" onclick="deleteAllMessages()" title="Delete All Messages"></i>
        <i class="fa-solid fa-circle-nodes" style="color: var(--primary); opacity: 0.5; margin-left: 10px;"></i>
      </div>
    </div>

    <div id="messages"></div>

    <div id="inputArea">
      <label for="imgInput"><i class="fa-solid fa-camera icon-btn"></i></label>
      <input type="file" id="imgInput" hidden accept="image/*" onchange="sendImage(this)">
      <input id="msgInput" placeholder="Encrypted message..." autocomplete="off">
      <button class="send-btn" onclick="sendMsg()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBEiUjtqLlT_cMCE0ba9mweak5QQp915vQ",
      authDomain: "borson-chat-web.firebaseapp.com",
      databaseURL: "https://borson-chat-web-default-rtdb.firebaseio.com",
      projectId: "borson-chat-web",
      storageBucket: "borson-chat-web.firebasestorage.app",
      messagingSenderId: "694928126106",
      appId: "1:694928126106:web:d02ab12ed214accd335528"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function createMoneyRain() {
      const container = document.getElementById('bg-animation');
      const icons = ['fa-sack-dollar', 'fa-bitcoin', 'fa-credit-card', 'fa-money-bill-wave', 'fa-gem', 'fa-coins'];
      setInterval(() => {
        const icon = document.createElement('i');
        icon.classList.add('fa-solid', icons[Math.floor(Math.random() * icons.length)], 'falling-icon');
        icon.style.left = Math.random() * 100 + 'vw';
        icon.style.fontSize = (Math.random() * 20 + 15) + 'px';
        icon.style.animationDuration = (Math.random() * 4 + 3) + 's'; 
        container.appendChild(icon);
        setTimeout(() => { icon.remove(); }, 7000);
      }, 400);
    }
    createMoneyRain();

    let myName = "", myID = "", isAdmin = false, activeChatID = "";
    let notificationEnabled = false;

    function requestPermissionAndLogin() {
      if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") notificationEnabled = true;
          login();
        });
      } else { login(); }
    }

    function login() {
      const name = document.getElementById("name").value.trim();
      const pass = document.getElementById("pass").value.trim();
      if (!name || !pass) return alert("Credentials required!");

      if (name === "borson_admin" && pass === "1234") {
        isAdmin = true;
        myName = "Admin";
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminPanel").style.display = "flex";
        loadUserList();
      } else {
        isAdmin = false;
        myName = name;
        myID = btoa(name + "_" + pass).replace(/=/g, ""); 
        activeChatID = myID;
        db.ref("users/" + myID).update({ name: myName, lastActive: Date.now() });
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("chatBox").style.display = "flex";
        loadMessages(myID);
      }
    }

    function loadUserList() {
      db.ref("users").on("value", snap => {
        const list = document.getElementById("userListContainer");
        list.innerHTML = "";
        snap.forEach(child => {
          const u = child.val();
          const uid = child.key;
          const div = document.createElement("div");
          div.className = "user-item";
          div.innerHTML = `
            <div>
              <div style="font-weight:600; font-size: 16px; color:white; margin-bottom: 5px;">${u.name}</div>
              <div style="font-size:11px; color: var(--primary); opacity: 0.7;"><i class="fa-solid fa-fingerprint"></i> ${uid.substr(0,8)}...</div>
            </div>
            <div style="display:flex; align-items:center;"><span class="unread-badge">OPEN</span></div>
          `;
          div.onclick = () => openChatAsAdmin(uid, u.name);
          list.appendChild(div);
        });
      });
    }

    function openChatAsAdmin(uid, name) {
      activeChatID = uid;
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("chatBox").style.display = "flex";
      document.getElementById("chatTitle").innerText = name;
      document.getElementById("backBtn").style.display = "block";
      document.getElementById("deleteAllBtn").style.display = "block"; 
      loadMessages(uid);
    }

    function closeChat() {
      document.getElementById("chatBox").style.display = "none";
      document.getElementById("adminPanel").style.display = "flex";
      document.getElementById("deleteAllBtn").style.display = "none"; 
      activeChatID = "";
    }

    function sendMsg() {
      const input = document.getElementById("msgInput");
      const text = input.value.trim();
      if (!text || !activeChatID) return;
      pushToDB(text, 'text');
      if (!isAdmin) checkAndSendAutoReply(activeChatID);
      input.value = "";
    }

    function checkAndSendAutoReply(uid) {
      const lastReplyTime = localStorage.getItem("lastAutoReplyTime");
      const currentTime = Date.now();
      if (!lastReplyTime || (currentTime - lastReplyTime > 1800000)) {
        setTimeout(() => {
          db.ref("chats/" + uid).push({ msg: "WAIT ü´∏.........", type: "text", sender: "Admin", time: Date.now() });
          localStorage.setItem("lastAutoReplyTime", currentTime);
        }, 1500);
      }
    }

    function sendImage(input) {
      const reader = new FileReader();
      reader.onload = e => {
        pushToDB(e.target.result, 'img');
        if (!isAdmin) checkAndSendAutoReply(activeChatID);
      };
      reader.readAsDataURL(input.files[0]);
    }

    function pushToDB(content, type) {
      db.ref("chats/" + activeChatID).push({ msg: content, type: type, sender: isAdmin ? "Admin" : myName, time: Date.now() });
      db.ref("users/" + activeChatID).update({ lastActive: Date.now() });
    }

    let msgRef;
    function loadMessages(uid) {
      const box = document.getElementById("messages");
      box.innerHTML = "";
      if (msgRef) msgRef.off();
      msgRef = db.ref("chats/" + uid);
      msgRef.on("child_added", snap => {
        const data = snap.val();
        if (!isAdmin && data.hiddenForUser) return;
        const isMe = data.sender === (isAdmin ? "Admin" : myName);
        if (!isMe) {
          document.getElementById("notifSound").play().catch(()=>{});
          if("vibrate" in navigator) navigator.vibrate(200);
          if (document.hidden && notificationEnabled) {
            new Notification("B√ìR·∫û√ï√ë ESTATE", { body: data.type === 'img' ? 'üì∑ Photo' : data.msg });
          }
        }
        const div = document.createElement("div");
        div.className = isMe ? "msg right" : "msg left";
        let contentHtml = data.type === 'img' ? `<img src="${data.msg}">` : data.msg;
        let deleteHtml = (isAdmin || isMe) ? `<div class="delete-btn" onclick="deleteMessage('${uid}', '${snap.key}')"><i class="fa-solid fa-trash-can"></i></div>` : "";
        div.innerHTML = `${contentHtml}<span class="time">${new Date(data.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>${deleteHtml}`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
      });
      msgRef.on("child_removed", () => loadMessages(uid));
      msgRef.on("child_changed", () => loadMessages(uid));
    }

    window.deleteMessage = function(chatPath, msgKey) {
      if (isAdmin) {
        if (confirm("Delete permanently for EVERYONE?")) db.ref("chats/" + chatPath + "/" + msgKey).remove();
      } else {
        if (confirm("Delete from MY device only?")) db.ref("chats/" + chatPath + "/" + msgKey).update({ hiddenForUser: true });
      }
    };

    window.deleteAllMessages = function() {
      if (confirm("Permanently delete ALL messages in this chat?")) db.ref("chats/" + activeChatID).remove();
    };
  </script>
</body>
</html>
